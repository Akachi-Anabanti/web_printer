# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
    config.vm.box = "ubuntu/focal64"
    config.vm.network "private_network", ip: "192.168.33.10"
    config.vm.provider "virtualbox" do |vb|
      vb.memory = "2048"
      vb.cpus = 2
    end
  
    config.vm.provision "shell", inline: <<-SHELL
      # Update and upgrade the system
      sudo apt-get update
      sudo apt-get upgrade -y
  
      # Install Java
      sudo apt-get install -y openjdk-11-jdk
  
      # Install Node.js and npm
      curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -
      sudo apt-get install -y nodejs
  
      # Install Maven
      sudo apt-get install -y maven
  
      # Install Git
      sudo apt-get install -y git
  
      # Install and configure MySQL
      sudo apt-get install -y mysql-server
      sudo mysql -e "CREATE DATABASE printer_management;"
      sudo mysql -e "CREATE USER 'printapp'@'localhost' IDENTIFIED BY 'password';"
      sudo mysql -e "GRANT ALL PRIVILEGES ON printer_management.* TO 'printapp'@'localhost';"
  
      # Install CUPS for printer management
      sudo apt-get install -y cups
  
      # Clone your application repository (replace with your actual repo URL)
      git clone https://github.com/yourusername/printer-management-app.git /home/vagrant/printer-management-app
  
      # Set up the backend
      cd /home/vagrant/printer-management-app/backend
      mvn clean install
  
      # Set up the frontend
      cd /home/vagrant/printer-management-app/frontend
      npm install
  
      # Add a startup script
      echo '#!/bin/bash
      cd /home/vagrant/printer-management-app/backend
      nohup mvn spring-boot:run > /dev/null 2>&1 &
      cd /home/vagrant/printer-management-app/frontend
      nohup npm start > /dev/null 2>&1 &
      ' > /home/vagrant/start_app.sh
  
      chmod +x /home/vagrant/start_app.sh
  
      echo "To start the application, SSH into the VM and run: ./start_app.sh"
    SHELL
  end